{"version":3,"file":"activity_visual.min.js","sources":["../src/activity_visual.js"],"sourcesContent":["// AMD-Modul (amd/src/activity_visual.js)\ndefine(['jquery', 'core/modal', 'core/modal_events'], function ($, Modal, ModalEvents) {\n    return {\n        init: function () {\n\n            $('.detach-block').on('click', function() {\n                const blockContent = $('.block-course-converter').clone(true);\n                // Original-Block ausblenden\n                $('.block-course-converter').addClass('d-none');\n                // Modal asynchron erstellen\n                Modal.create({\n                    title: \"Activity Tree Visual\",\n                    // title by section\n                    // title: blockContent.find('.page-wrapper.d-block').find('.card-header h5').text(),\n                    body: this.displayActivityVisual(),\n                    // body by section\n                    // body: blockContent.find('.page-wrapper.d-block').find('.card-body').html(), //TODO find correct body\n                    // footer: blockContent.find('.card-footer').html(),\n                    large: true\n                }).then(function (modal) {\n                    modal.show();\n                    // Bei Schließen wieder einblenden\n                    modal.getRoot().on(ModalEvents.hidden, function () {\n                        $('.block-course-converter').removeClass('d-none');\n                        updateSectionHighlight(null);\n                    });\n                });\n            });\n        },\n        displayActivityVisual: function () {\n            const container = $('.block_course_audit');\n            const sections = {};\n\n            // 1. Aktivitäten nach Abschnitten gruppieren und sortieren\n            container.find('.activity-item[data-restrictions][data-index]').each(function () {\n                const $item = $(this);\n                const sectionId = $item.closest('.section-page').data('section-number');\n                if (!sections[sectionId]) {\n                    sections[sectionId] = [];\n                }\n                sections[sectionId].push({\n                    element: $item,\n                    index: $item.data('index'),\n                    restrictions: $item.data('restrictions').split(',')\n                });\n            });\n            // 2. Neues Grid-Layout erstellen\n            const grid = $('<div class=\"activity-grid row\"></div>');\n            // 3. Spalten für jeden Abschnitt erstellen\n            Object.keys(sections).sort().forEach(sectionId => {\n                const column = $(`\n                    <div class=\"activity-column col-md-4 mb-4\">\n                        <h5>Section ${sectionId}</h5>\n                        <div class=\"activity-list\"></div>\n                    </div>\n                `);\n\n                sections[sectionId].sort((a, b) => a.index - b.index).forEach(activity => {\n                    const iconClass = this.getActivityIcon(activity.element.data('activity-type'));\n                    column.find('.activity-list').append(`\n                        <div class=\"activity-card mb-2 p-2\"\n                             data-index=\"${activity.index}\"\n                             data-restrictions=\"${activity.restrictions.join(',')}\">\n                            <i class=\"fa ${iconClass} mr-2\"></i>\n                            ${activity.element.find('.activity-name').text()}\n                        </div>\n                    `);\n                });\n\n                grid.append(column);\n            });\n\n            // // 4. Alten Container ersetzen\n            return grid;\n            // container.html(grid);\n\n            // // 5. Verbindungslinien zeichnen\n            // this.drawConnections();\n\n            // // Bei Fensteränderung neu zeichnen\n            // $(window).on('resize', () => this.drawConnections());\n        },\n\n        getActivityIcon: function (type) {\n            const icons = {\n                quiz: 'fa-question-circle',\n                lesson: 'fa-book-open',\n                forum: 'fa-comments',\n                assign: 'fa-file-upload',\n                default: 'fa-circle'\n            };\n            return icons[type] || icons.default;\n        },\n\n        drawConnections: function () {\n            // Alte Linien entfernen\n            $('.connection-line').remove();\n\n            // SVG Container erstellen\n            const svg = $(`\n                <svg class=\"connection-layer\" \n                     style=\"position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none;\">\n                </svg>\n            `);\n\n            $('.activity-grid').append(svg);\n\n            // Für jede Aktivität Verbindungen zeichnen\n            $('.activity-card[data-restrictions]').each(function () {\n                const source = $(this);\n                const sourcePos = source.offset();\n                // const sourceIndex = source.data('index');\n\n                source.data('restrictions').split(',').forEach(restriction => {\n                    const targetIndex = restriction.split('_').pop();\n                    const target = $(`.activity-card[data-index=\"${targetIndex}\"]`);\n\n                    if (target.length) {\n                        const targetPos = target.offset();\n                        // Linie zeichnen\n                        const line = $(`\n                            <line class=\"connection-line\"\n                                x1=\"${sourcePos.left + source.width() - 10}\" \n                                y1=\"${sourcePos.top + source.height() / 2}\"\n                                x2=\"${targetPos.left + 10}\"\n                                y2=\"${targetPos.top + target.height() / 2}\"\n                                stroke=\"#007bff\"\n                                stroke-width=\"2\"\n                                marker-end=\"url(#arrowhead)\"/>\n                        `);\n\n                        svg.append(line);\n                    }\n                });\n            });\n\n            // Pfeilspitze definieren\n            svg.prepend(`\n                <defs>\n                    <marker id=\"arrowhead\" markerWidth=\"10\" markerHeight=\"7\" \n                            refX=\"9\" refY=\"3.5\" orient=\"auto\">\n                        <polygon points=\"0 0, 10 3.5, 0 7\" fill=\"#007bff\"/>\n                    </marker>\n                </defs>\n            `);\n        }\n    };\n});"],"names":["define","$","Modal","ModalEvents","init","on","clone","addClass","create","title","body","this","displayActivityVisual","large","then","modal","show","getRoot","hidden","removeClass","updateSectionHighlight","container","sections","find","each","$item","sectionId","closest","data","push","element","index","restrictions","split","grid","Object","keys","sort","forEach","column","a","b","activity","iconClass","getActivityIcon","append","join","text","type","icons","quiz","lesson","forum","assign","default","drawConnections","remove","svg","source","sourcePos","offset","restriction","targetIndex","pop","target","length","targetPos","line","left","width","top","height","prepend"],"mappings":"AACAA,gDAAO,CAAC,SAAU,aAAc,sBAAsB,SAAUC,EAAGC,MAAOC,mBAC/D,CACHC,KAAM,WAEFH,EAAE,iBAAiBI,GAAG,SAAS,WACNJ,EAAE,2BAA2BK,OAAM,GAExDL,EAAE,2BAA2BM,SAAS,UAEtCL,MAAMM,OAAO,CACTC,MAAO,uBAGPC,KAAMC,KAAKC,wBAIXC,OAAO,IACRC,MAAK,SAAUC,OACdA,MAAMC,OAEND,MAAME,UAAUZ,GAAGF,YAAYe,QAAQ,WACnCjB,EAAE,2BAA2BkB,YAAY,UACzCC,uBAAuB,gBAKvCR,sBAAuB,iBACbS,UAAYpB,EAAE,2BACdqB,SAAW,GAGjBD,UAAUE,KAAK,iDAAiDC,MAAK,iBAC3DC,MAAQxB,EAAEU,MACVe,UAAYD,MAAME,QAAQ,iBAAiBC,KAAK,kBACjDN,SAASI,aACVJ,SAASI,WAAa,IAE1BJ,SAASI,WAAWG,KAAK,CACrBC,QAASL,MACTM,MAAON,MAAMG,KAAK,SAClBI,aAAcP,MAAMG,KAAK,gBAAgBK,MAAM,gBAIjDC,KAAOjC,EAAE,gDAEfkC,OAAOC,KAAKd,UAAUe,OAAOC,SAAQZ,kBAC3Ba,OAAStC,mHAEOyB,6HAKtBJ,SAASI,WAAWW,MAAK,CAACG,EAAGC,IAAMD,EAAET,MAAQU,EAAEV,QAAOO,SAAQI,iBACpDC,UAAYhC,KAAKiC,gBAAgBF,SAASZ,QAAQF,KAAK,kBAC7DW,OAAOhB,KAAK,kBAAkBsB,yHAEPH,SAASX,oEACFW,SAASV,aAAac,KAAK,6DAClCH,8DACbD,SAASZ,QAAQP,KAAK,kBAAkBwB,qEAKtDb,KAAKW,OAAON,WAITL,MAUXU,gBAAiB,SAAUI,YACjBC,MAAQ,CACVC,KAAM,qBACNC,OAAQ,eACRC,MAAO,cACPC,OAAQ,iBACRC,QAAS,oBAENL,MAAMD,OAASC,MAAMK,SAGhCC,gBAAiB,WAEbtD,EAAE,oBAAoBuD,eAGhBC,IAAMxD,2MAMZA,EAAE,kBAAkB4C,OAAOY,KAG3BxD,EAAE,qCAAqCuB,MAAK,iBAClCkC,OAASzD,EAAEU,MACXgD,UAAYD,OAAOE,SAGzBF,OAAO9B,KAAK,gBAAgBK,MAAM,KAAKK,SAAQuB,oBACrCC,YAAcD,YAAY5B,MAAM,KAAK8B,MACrCC,OAAS/D,uCAAgC6D,sBAE3CE,OAAOC,OAAQ,OACTC,UAAYF,OAAOJ,SAEnBO,KAAOlE,6GAEC0D,UAAUS,KAAOV,OAAOW,QAAU,sDAClCV,UAAUW,IAAMZ,OAAOa,SAAW,oDAClCL,UAAUE,KAAO,qDACjBF,UAAUI,IAAMN,OAAOO,SAAW,sMAMhDd,IAAIZ,OAAOsB,aAMvBV,IAAIe"}